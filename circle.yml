machine:
    python:
        version: 3.5
    #pre:
    #    - if [ ! -e '/home/ubuntu/virtualenvs/venv-3.5.2' ]; then mkdir -p '/home/ubuntu/virtualenvs'; pushd '/home/ubuntu/virtualenvs'; virtualenv venv-3.5.2; popd; fi
    post:
        - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh
        - bash ~/miniconda.sh -b -p $HOME/miniconda
    environment:
        PATH: "$HOME/miniconda/bin:$PATH"

dependencies:
    override:
        - sudo apt-get install -y default-jre gfortran
        - conda update conda
        - conda install --yes anaconda-client anaconda-build conda-build
        - conda config --add channels r
        - conda install --yes r r-essentials numpy pandas scikit-learn imbalanced-learn nilearn scipy matplotlib networkx statsmodels
        - $HOME/miniconda/bin/pip install rpy2 jinja2 ipdb fancyimpute IPython
        - $HOME/miniconda/bin/pip install pytest
        - echo "install.packages(c("mpath","glmnet","foreach","iterators","pscl","numDeriv","doParallel"),repos="http://cran.us.r-project.org", dependencies=TRUE)" | R --vanilla
    cache_directories:
        - "$HOME/miniconda"
test:
    override:
        - tests/test_prediction.py
